"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[8305],{5250:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>m,frontMatter:()=>i,metadata:()=>s,toc:()=>c});var t=r(4848),a=r(8453);const i={sidebar_position:2,title:"Command"},o=void 0,s={id:"resources/commands/command",title:"Command",description:"The command object is a simple DTO object that can also house the callback",source:"@site/docs/resources/commands/command.md",sourceDirName:"resources/commands",slug:"/resources/commands/command",permalink:"/docs/resources/commands/command",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/resources/commands/command.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2,title:"Command"},sidebar:"tutorialSidebar",previous:{title:"Overview",permalink:"/docs/resources/commands/overview"},next:{title:"Commands Handler",permalink:"/docs/resources/commands/commands-handler"}},d={},c=[{value:"Requirements",id:"requirements",level:2},{value:"Example",id:"example",level:2},{value:"Validating arguments",id:"validating-arguments",level:2}];function l(e){const n={a:"a",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"The command object is a simple DTO object that can also house the callback\r\nif the addon has a good class structure."}),"\n",(0,t.jsx)(n.p,{children:"It basically holds the required information to register a slash command in\r\nthe game:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Operation:"})," the ",(0,t.jsx)(n.code,{children:"setOperation(operation)"})," expects a string operation\r\nname which will be the one used by the library to forward the command\r\nexecution."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Callback:"})," the ",(0,t.jsx)(n.code,{children:"setCallback(callback)"})," expects a function that will be\r\nexecuted when the library captures a command. This function may expect\r\nparameters that will be parsed by the commands handler."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Description:"})," optional property set with ",(0,t.jsx)(n.code,{children:"setDescription(description)"}),"\r\nthat will also store additional information for that command. When defined,\r\nthe ",(0,t.jsx)(n.a,{href:"commands-handler#the-help-operation",children:"default help operation"})," will print\r\nit after the operation name."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Arguments Validator:"})," optional function that will be executed before the\r\ncallback. It should return a ",(0,t.jsx)(n.strong,{children:"string"})," with ",(0,t.jsx)(n.code,{children:"'valid'"})," when the arguments are\r\nvalid, or any other string with the error message to be printed in the chat.","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"As posted above, this is an optional feature that will save some sanity\r\nchecks in the callback function and when not provided, the library will\r\nassume that arguments are always valid."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"requirements",children:"Requirements"}),"\n",(0,t.jsxs)(n.p,{children:["In order to add commands, the library must be initialized with the ",(0,t.jsx)(n.code,{children:"command"}),"\r\nproperty. After that, every command instance created in the example below will\r\nbe registered as an operation that will be executed by the registered command."]}),"\n",(0,t.jsxs)(n.p,{children:["Read the ",(0,t.jsx)(n.a,{href:"../core/addon-properties",children:"Addon Properties"})," documentation for more\r\nreference."]}),"\n",(0,t.jsx)(n.h2,{id:"example",children:"Example"}),"\n",(0,t.jsxs)(n.p,{children:["Imagine an addon that needs to register a ",(0,t.jsx)(n.strong,{children:"clear"})," command that will clear\r\na table. Something like a cache clear. The addon holds the library instance\r\nin a property called ",(0,t.jsx)(n.code,{children:"library"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["First, the library must be initialized with the ",(0,t.jsx)(n.code,{children:"command"})," property:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:"CustomAddon.library = StormwindLibrary.new({\r\n  command = 'myAddon',\r\n  -- other properties here\r\n})\n"})}),"\n",(0,t.jsx)(n.p,{children:"After that, it's possible to register any other commands, called operations,\r\nas necessary."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:"-- instantiates a command using the library factory\r\nlocal command = CustomAddon.library:new('Command')\r\n\r\nfunction command:commandExecution(arg1, arg2)\r\n    -- execute any addon code here\r\n    print('command executed with arg1 = ' .. arg1 .. ', and arg2 = ' .. arg2)\r\nend\r\n\r\ncommand\r\n    :setDescription('Clears the addon cache')\r\n    :setOperation('clear')\r\n    :setCallback(command.commandExecution)\r\n\r\n-- registers the command in the library\r\nCustomAddon.library.commands:add(command)\n"})}),"\n",(0,t.jsx)(n.p,{children:"In game, running the following line in the chat will execute the command:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"/myAddon clear\n"})}),"\n",(0,t.jsx)(n.h2,{id:"validating-arguments",children:"Validating arguments"}),"\n",(0,t.jsxs)(n.p,{children:["See the example above where the ",(0,t.jsx)(n.code,{children:"commandExecution"})," function is expecting two\r\narguments and is printing them. It could be updated to validate the arguments\r\nlike this:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:"function command:commandExecution(arg1, arg2)\r\n    if not arg1 then\r\n        print('arg1 is required')\r\n        return\r\n    end\r\n\r\n    if arg2 and tonumber(arg2) < 0 then\r\n        print('arg2 must be a positive number')\r\n        return\r\n    end\r\n\r\n    -- other validations here...\r\n\r\n    print('command executed with arg1 = ' .. arg1 .. ', and arg2 = ' .. arg2)\r\nend\n"})}),"\n",(0,t.jsxs)(n.p,{children:["For many commands, it will inevitably lead to a lot of validation code in their\r\ncallback functions. That would also makes unit tests more complex. To separate\r\nresponsibilities, it's possible to use the ",(0,t.jsx)(n.code,{children:"setArgsValidator()"})," method to\r\nprovide a function that will be executed before the callback."]}),"\n",(0,t.jsxs)(n.p,{children:["The function must return a string with ",(0,t.jsx)(n.code,{children:"'valid'"})," when the arguments are valid,\r\nor any other string with the error message to be printed in the chat."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:"-- instantiates a command using the library factory\r\nlocal command = CustomAddon.library:new('Command')\r\n\r\ncommand:setArgsValidator(function (arg1, arg2))\r\n    if not arg1 then\r\n        return 'arg1 is required'\r\n    end\r\n\r\n    if arg2 and tonumber(arg2) < 0 then\r\n        return 'arg2 must be a positive number'\r\n    end\r\n\r\n    -- other validations here...\r\n\r\n    return 'valid'\r\nend\n"})}),"\n",(0,t.jsxs)(n.p,{children:["When the command is executed, the commands handler will execute the validator\r\nfunction before the callback. If the validator returns ",(0,t.jsx)(n.code,{children:"'valid'"}),", the callback\r\nwill be executed. Otherwise, the error message will be printed in the chat."]})]})}function m(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>s});var t=r(6540);const a={},i=t.createContext(a);function o(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);